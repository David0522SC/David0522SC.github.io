<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ™‚å…‰æ—…ç¨‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CSSï¼ˆç”¨ä¾†æ’ç‰ˆè·Ÿæ¨£å¼ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#0f172a; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .animate-fade-in { animation:fadeIn .4s ease-out }
  </style>
</head>
<body class="min-h-screen text-white">
  <div id="root"></div>

  <!-- React + ReactDOM + Babelï¼ˆè®“ç€è¦½å™¨ç›´æ¥è·‘ JSXï¼‰ -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- è¾²æ›†å¥—ä»¶ï¼ˆé¡¯ç¤ºè¾²æ›†ç”Ÿæ—¥ç”¨ï¼Œå¯ä»¥ä¸ç®¡ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // å°å° icon å…ƒä»¶ï¼Œç”¨ emoji ä»£æ›¿åŸæœ¬çš„ lucide-react
    const Icon = ({ emoji, className }) => (
      <span className={className} aria-hidden="true">{emoji}</span>
    );

    // ç”Ÿå‘½ç´¯ç©æ™‚é–“
    function calculateDetails(dateStr, timeStr) {
      const start = new Date(dateStr + "T" + timeStr);
      const now = new Date();
      if (isNaN(start.getTime()) || start > now) return null;

      const diffMs = now - start;
      const totalSeconds = Math.floor(diffMs / 1000);

      let years = now.getFullYear() - start.getFullYear();
      let months = now.getMonth() - start.getMonth();
      let days = now.getDate() - start.getDate();
      let hours = now.getHours() - start.getHours();
      let minutes = now.getMinutes() - start.getMinutes();
      let seconds = now.getSeconds() - start.getSeconds();

      if (seconds < 0) { seconds += 60; minutes--; }
      if (minutes < 0) { minutes += 60; hours--; }
      if (hours < 0) { hours += 24; days--; }
      if (days < 0) {
        const pm = new Date(now.getFullYear(), now.getMonth(), 0);
        days += pm.getDate();
        months--;
      }
      if (months < 0) { months += 12; years--; }

      return { years, months, days, hours, minutes, seconds, totalSeconds };
    }

    // å€’æ•¸æ—¥
    function calculateCountdown(dateStr, timeStr) {
      const target = new Date(dateStr + "T" + timeStr);
      const now = new Date();
      if (isNaN(target.getTime())) return { status: "past" };

      const diffMs = target - now;
      const isSameDay =
        target.getFullYear() === now.getFullYear() &&
        target.getMonth() === now.getMonth() &&
        target.getDate() === now.getDate();

      if (diffMs > 0) {
        const totalSeconds = Math.floor(diffMs / 1000);
        const days = Math.floor(totalSeconds / 86400);
        const hours = Math.floor((totalSeconds % 86400) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        return { status:"future", days, hours, minutes, seconds, totalSeconds };
      } else if (isSameDay) {
        const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23,59,59);
        const totalSeconds = Math.max(0, Math.floor((end - now)/1000));
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        return { status:"today", days:0, hours, minutes, seconds, totalSeconds };
      }
      return { status:"past" };
    }

    function getLunarString(dateStr) {
      try {
        if (!window.Solar) return "";
        const d = new Date(dateStr);
        const solar = window.Solar.fromYmd(d.getFullYear(), d.getMonth()+1, d.getDate());
        const lunar = solar.getLunar();
        return lunar.getMonthInChinese() + "æœˆ" + lunar.getDayInChinese();
      } catch { return ""; }
    }

    const NumberCard = ({ value, label, sub }) => (
      <div className="flex flex-col items-center justify-center p-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition animate-fade-in">
        <div className="text-4xl font-mono font-bold">{value}</div>
        <div className="text-xs text-slate-300 mt-1">{label}</div>
        {sub && <div className="text-[10px] text-slate-400">{sub}</div>}
      </div>
    );

    const MilestoneRow = ({ label, value, unit }) => (
      <div className="flex justify-between items-center py-2 border-b border-white/5 text-sm">
        <span className="text-slate-300 flex items-center gap-1">
          <Icon emoji="ğŸ“ˆ" /> {label}
        </span>
        <span className="font-mono text-lg">
          {value} <span className="text-xs text-slate-400">{unit}</span>
        </span>
      </div>
    );

    function DetailView({ profile, onBack }) {
      const [tick, setTick] = useState(0);

      useEffect(() => {
        const id = setInterval(() => setTick(t => t+1), 1000);
        return () => clearInterval(id);
      }, []);

      const stats = useMemo(() => {
        if (profile.type === "countdown")
          return calculateCountdown(profile.date, profile.time);
        return calculateDetails(profile.date, profile.time);
      }, [profile, tick]);

      if (!stats) {
        return (
          <div className="text-center mt-16">
            <p className="mb-4">æ™‚é–“ä¼¼ä¹é‚„æ²’åˆ°ï¼ˆèµ·å§‹æ™‚é–“åœ¨æœªä¾†ï¼‰ã€‚</p>
            <button onClick={onBack} className="px-4 py-2 bg-slate-700 rounded-xl">è¿”å›</button>
          </div>
        );
      }

      if (profile.type === "countdown" && stats.status === "past") {
        return (
          <div className="text-center mt-16 space-y-4">
            <Icon emoji="âœ…" className="text-4xl" />
            <h2 className="text-2xl font-bold">{profile.name}</h2>
            <p className="text-slate-300">é€™å€‹æ—¥å­å·²ç¶“éå»äº†ã€‚</p>
            <button onClick={onBack} className="px-4 py-2 bg-slate-700 rounded-xl mt-4">
              è¿”å›åˆ—è¡¨
            </button>
          </div>
        );
      }

      const pad = n => String(n).padStart(2,"0");

      const totalDays = Math.floor(stats.totalSeconds/86400);
      const totalWeeks = profile.type === "countdown"
        ? null
        : Math.floor(stats.totalSeconds / (7*86400));

      const titleTag =
        profile.type === "life" ? "æ™‚å…‰è¶³è·¡" :
        profile.type === "anniversary" ? "ç´€å¿µæ—¥" : "å€’æ•¸æ—¥";

      return (
        <div className="space-y-8">
          <button
            onClick={onBack}
            className="inline-flex items-center gap-1 px-3 py-1 rounded-xl bg-white/5 hover:bg-white/10 text-sm"
          >
            <Icon emoji="â†" /> è¿”å›åˆ—è¡¨
          </button>

          <div>
            <div className="text-xs text-slate-400 mb-1">{titleTag}</div>
            <h2 className="text-2xl font-bold flex items-center gap-2">
              {profile.name}
              {profile.relation && (
                <span className="text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10">
                  {profile.relation}
                </span>
              )}
            </h2>
            <div className="text-xs text-slate-400 mt-1 flex flex-wrap items-center gap-2">
              <span><Icon emoji="ğŸ“…" /> {profile.date}</span>
              {profile.type === "life" && (
                <span className="px-2 py-0.5 rounded-full bg-indigo-500/10 text-indigo-200 text-[10px]">
                  è¾²æ›† {getLunarString(profile.date)}
                </span>
              )}
            </div>
          </div>

          {/* æ•¸å­—å€ */}
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
            {profile.type === "countdown" && stats.status === "today" ? (
              <>
                <NumberCard value={pad(stats.hours)} label="å°æ™‚" />
                <NumberCard value={pad(stats.minutes)} label="åˆ†é˜" />
                <NumberCard value={pad(stats.seconds)} label="ç§’" sub="ä»Šæ—¥çµæŸå€’æ•¸" />
              </>
            ) : profile.type === "countdown" ? (
              <>
                <NumberCard value={totalDays} label="å‰©é¤˜å¤©æ•¸" />
                <NumberCard value={pad(stats.hours)} label="å°æ™‚" />
                <NumberCard value={pad(stats.minutes)} label="åˆ†é˜" />
                <NumberCard value={pad(stats.seconds)} label="ç§’" />
              </>
            ) : (
              <>
                <NumberCard value={stats.years} label="å¹´" />
                <NumberCard value={stats.months} label="å€‹æœˆ" />
                <NumberCard value={stats.days} label="å¤©" />
                <NumberCard value={pad(stats.hours)} label="å°æ™‚" />
                <NumberCard value={pad(stats.minutes)} label="åˆ†é˜" />
                <NumberCard value={pad(stats.seconds)} label="ç§’" sub="å³æ™‚è·³å‹•" />
              </>
            )}
          </div>

          {/* ç¸½ç§’æ•¸ / é‡Œç¨‹ç¢‘ */}
          <div className="grid md:grid-cols-2 gap-6">
            <div className="p-6 rounded-2xl bg-slate-800/80 border border-white/10">
              <div className="text-xs text-slate-400 mb-2">
                {profile.type === "countdown" ? "ç¸½å€’æ•¸ç§’æ•¸" : "åœ¨é€™å€‹æ˜Ÿçƒä¸Šçš„ç¸½ç§’æ•¸"}
              </div>
              <div className="text-3xl md:text-4xl font-mono font-bold text-emerald-300">
                {stats.totalSeconds.toLocaleString()} <span className="text-base text-slate-400">ç§’</span>
              </div>
              <p className="text-xs text-slate-400 mt-3">
                {profile.type === "countdown"
                  ? "æœŸå¾…é‚£ä¸€å¤©çš„åˆ°ä¾†ã€‚"
                  : "æ¯ä¸€ç§’éƒ½åœ¨ç´¯ç©ä½ çš„æ•…äº‹ã€‚"}
              </p>
            </div>

            <div className="p-6 rounded-2xl bg-slate-800/80 border border-white/10">
              <div className="text-xs text-slate-400 mb-2">
                {profile.type === "countdown" ? "å€’æ•¸é‡Œç¨‹ç¢‘" : "ç´¯ç©é‡Œç¨‹ç¢‘"}
              </div>
              <div className="space-y-1">
                <MilestoneRow label="ç¸½å¤©æ•¸" value={totalDays.toLocaleString()} unit="å¤©" />
                {totalWeeks !== null && (
                  <MilestoneRow label="ç¸½é€±æ•¸" value={totalWeeks.toLocaleString()} unit="é€±" />
                )}
                <MilestoneRow
                  label="ç¸½å°æ™‚"
                  value={Math.floor(stats.totalSeconds/3600).toLocaleString()}
                  unit="å°æ™‚"
                />
              </div>
            </div>
          </div>
        </div>
      );
    }

    function LifeJourneyApp() {
      const [view, setView] = useState("dashboard"); // dashboard | form | detail
      const [activeTab, setActiveTab] = useState("life"); // life | anniversary | countdown
      const [profiles, setProfiles] = useState(() => {
        try {
          const raw = localStorage.getItem("lifeJourneyProfiles");
          return raw ? JSON.parse(raw) : [];
        } catch { return []; }
      });
      const [formData, setFormData] = useState({
        name:"",
        relation:"",
        date:"",
        time:"00:00",
        type:"life"
      });
      const [selectedId, setSelectedId] = useState(null);

      useEffect(() => {
        localStorage.setItem("lifeJourneyProfiles", JSON.stringify(profiles));
      }, [profiles]);

      const currentList = useMemo(
        () => profiles.filter(p => p.type === activeTab),
        [profiles, activeTab]
      );

      const selectedProfile = useMemo(
        () => profiles.find(p => p.id === selectedId) || null,
        [profiles, selectedId]
      );

      function openForm() {
        setFormData({
          name:"",
          relation:"",
          date:"",
          time:"00:00",
          type: activeTab
        });
        setView("form");
      }

      function saveProfile() {
        if (!formData.name || !formData.date) return;
        const id = Date.now().toString();
        setProfiles(prev => [...prev, { ...formData, type:activeTab, id }]);
        setView("dashboard");
      }

      function deleteProfile(id) {
        if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ")) return;
        setProfiles(prev => prev.filter(p => p.id !== id));
        if (selectedId === id) {
          setSelectedId(null);
          setView("dashboard");
        }
      }

      return (
        <div className="min-h-screen pb-16">
          {/* é ­éƒ¨ */}
          {view === "dashboard" && (
            <header className="text-center pt-10 pb-6">
              <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-white/10 mb-3">
                <Icon emoji="â³" className="text-2xl" />
              </div>
              <h1 className="text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-200 to-purple-200">
                æ™‚å…‰æ—…ç¨‹
              </h1>
              <p className="text-slate-400 text-sm mt-2">
                ç´€éŒ„æ¯ä¸€å€‹é‡è¦çš„äººï¼Œèˆ‡æ¯ä¸€å€‹å€¼å¾—ç´€å¿µçš„ç¬é–“ã€‚
              </p>
            </header>
          )}

          <main className="max-w-5xl mx-auto px-4">
            {/* é ç±¤ */}
            {view !== "detail" && (
              <div className="flex justify-center mb-6">
                <div className="inline-flex bg-white/5 rounded-2xl p-1 border border-white/10">
                  <button
                    className={
                      "px-4 py-1.5 rounded-xl text-sm flex items-center gap-1 " +
                      (activeTab === "life"
                        ? "bg-indigo-500 text-white"
                        : "text-slate-300 hover:bg-white/10")
                    }
                    onClick={() => setActiveTab("life")}
                  >
                    <Icon emoji="ğŸ‘¤" /> æ™‚å…‰è¶³è·¡
                  </button>
                  <button
                    className={
                      "px-4 py-1.5 rounded-xl text-sm flex items-center gap-1 " +
                      (activeTab === "anniversary"
                        ? "bg-pink-500 textç™½"
                        : "text-slate-300 hover:bg-white/10")
                    }
                    onClick={() => setActiveTab("anniversary")}
                  >
                    <Icon emoji="ğŸ" /> ç´€å¿µæ—¥
                  </button>
                  <button
                    className={
                      "px-4 py-1.5 rounded-xl text-sm flex items-center gap-1 " +
                      (activeTab === "countdown"
                        ? "bg-sky-500 text-white"
                        : "text-slate-300 hover:bg-white/10")
                    }
                    onClick={() => setActiveTab("countdown")}
                  >
                    <Icon emoji="â³" /> å€’æ•¸æ—¥
                  </button>
                </div>
              </div>
            )}

            {/* ä¸»ç•«é¢ / è¡¨å–® / è©³ç´° */}
            {view === "dashboard" && (
              <div className="grid md:grid-cols-2 gap-4">
                {currentList.map(p => {
                  let bigText = "";
                  let tag = "";
                  if (p.type === "countdown") {
                    const s = calculateCountdown(p.date, p.time);
                    if (s.status === "future") {
                      bigText = s.days + " å¤©";
                      tag = "å³å°‡åˆ°ä¾†";
                    } else if (s.status === "today") {
                      bigText = "ä»Šå¤©";
                      tag = "ä»Šæ—¥å€’æ•¸";
                    } else {
                      bigText = "å·²çµæŸ";
                      tag = "å·²çµæŸ";
                    }
                  } else {
                    const s = calculateDetails(p.date, p.time);
                    if (s) {
                      bigText =
                        s.years > 0
                          ? `${s.years} å¹´ ${s.months} æœˆ`
                          : `${Math.floor(s.totalSeconds/86400)} å¤©`;
                    } else {
                      bigText = "å°šæœªé–‹å§‹";
                    }
                  }

                  return (
                    <div
                      key={p.id}
                      className="p-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer transition"
                      onClick={() => { setSelectedId(p.id); setView("detail"); }}
                    >
                      <div className="flex justify-between items-start mb-2">
                        <div>
                          <div className="flex items-center gap-2">
                            <h3 className="font-semibold">{p.name}</h3>
                            {p.relation && (
                              <span className="text-[10px] px-2 py-0.5 rounded-full bg-white/10 border border-white/10">
                                {p.relation}
                              </span>
                            )}
                          </div>
                          <div className="text-xs text-slate-400 mt-1 flex items-center gap-1">
                            <Icon emoji="ğŸ“…" /> {p.date}
                          </div>
                        </div>
                        <button
                          className="text-xs text-slate-400 hover:text-red-400"
                          onClick={e => { e.stopPropagation(); deleteProfile(p.id); }}
                        >
                          åˆªé™¤
                        </button>
                      </div>
                      <div className="mt-3 flex items-baseline gap-2">
                        <span className="text-2xl font-mono font-bold">{bigText}</span>
                        {tag && <span className="text-xs text-slate-400">{tag}</span>}
                      </div>
                    </div>
                  );
                })}

                <button
                  onClick={openForm}
                  className="h-[140px] border-2 border-dashed border-white/15 rounded-2xl flex flex-col items-center justify-center text-slate-300 hover:border-indigo-400 hover:text-indigo-200 hover:bg-white/5 transition"
                >
                  <Icon emoji="ï¼‹" className="text-2xl mb-1" />
                  <span className="text-sm">
                    æ–°å¢{activeTab === "life" ? "æ™‚å…‰è¶³è·¡" : activeTab === "anniversary" ? "ç´€å¿µæ—¥" : "å€’æ•¸æ—¥"}
                  </span>
                </button>
              </div>
            )}

            {view === "form" && (
              <div className="max-w-md mx-auto mt-6 p-6 rounded-2xl bg-white/5 border border-white/10 space-y-4">
                <h2 className="font-semibold flex items-center gap-2">
                  <Icon emoji={activeTab === "life" ? "ğŸ‘¤" : activeTab === "anniversary" ? "ğŸ" : "â³"} />
                  æ–°å¢{activeTab === "life" ? "æ™‚å…‰è¶³è·¡" : activeTab === "anniversary" ? "ç´€å¿µæ—¥" : "å€’æ•¸æ—¥"}
                </h2>

                <div className="space-y-3 text-sm">
                  <div>
                    <label className="block text-slate-300 mb-1">é¡¯ç¤ºåç¨±</label>
                    <input
                      className="w-full px-3 py-2 rounded-xl bg-slate-900 border border-white/10 text-sm"
                      value={formData.name}
                      onChange={e => setFormData({ ...formData, name:e.target.value })}
                      placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜ã€æˆ‘å€‘çš„ç´€å¿µæ—¥ã€æœŸæœ«è€ƒ..."
                    />
                  </div>
                  <div>
                    <label className="block text-slate-300 mb-1">é—œä¿‚ / æè¿°</label>
                    <input
                      className="w-full px-3 py-2 rounded-xl bg-slate-900 border border-white/10 text-sm"
                      value={formData.relation}
                      onChange={e => setFormData({ ...formData, relation:e.target.value })}
                      placeholder="ä¾‹å¦‚ï¼šè‡ªå·±ã€å¥½å‹ã€æƒ…äººã€é‡è¦è€ƒè©¦..."
                    />
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="block text-slate-300 mb-1">æ—¥æœŸ</label>
                      <input
                        type="date"
                        className="w-full px-3 py-2 rounded-xl bg-slate-900 border border-white/10 text-sm"
                        value={formData.date}
                        onChange={e => setFormData({ ...formData, date:e.target.value })}
                      />
                    </div>
                    <div>
                      <label className="block text-slate-300 mb-1">æ™‚é–“</label>
                      <input
                        type="time"
                        className="w-full px-3 py-2 rounded-xl bg-slate-900 border border-white/10 text-sm"
                        value={formData.time}
                        onChange={e => setFormData({ ...formData, time:e.target.value })}
                      />
                    </div>
                  </div>
                </div>

                <div className="flex gap-3 pt-2">
                  <button
                    className="flex-1 px-3 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-sm"
                    onClick={() => setView("dashboard")}
                  >
                    å–æ¶ˆ
                  </button>
                  <button
                    className="flex-1 px-3 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-sm font-semibold disabled:opacity-50"
                    disabled={!formData.name || !formData.date}
                    onClick={saveProfile}
                  >
                    å„²å­˜
                  </button>
                </div>
              </div>
            )}

            {view === "detail" && selectedProfile && (
              <div className="mt-6">
                <DetailView
                  profile={selectedProfile}
                  onBack={() => setView("dashboard")}
                />
              </div>
            )}
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<LifeJourneyApp />);
  </script>
</body>
</html>
