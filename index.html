<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ™‚å…‰æ—…ç¨‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ç°¡å–®ç”¨ä¸€ä»½ Tailwind CDN ä¾†è®“æ¨£å¼ä¸æœƒå¤ªé†œï¼ˆçœ‹ä¸æ‡‚æ²’é—œä¿‚ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: #0f172a;
      color: white;
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    .animate-fade-in-up {
      animation: fadeInUp 0.5s ease-out;
    }
    .animate-fade-in-down {
      animation: fadeInDown 0.5s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0 }
      to { opacity: 1 }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px) }
      to { opacity: 1; transform: translateY(0) }
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-10px) }
      to { opacity: 1; transform: translateY(0) }
    }
    .animate-heartbeat {
      animation: heartbeat 1.5s ease-in-out infinite both;
    }
    @keyframes heartbeat {
      0% { transform: scale(1); }
      14% { transform: scale(1.15); }
      28% { transform: scale(1); }
      42% { transform: scale(1.15); }
      70% { transform: scale(1); }
    }
  </style>
</head>
<body class="min-h-screen">
  <div id="root"></div>

  <!-- React + ReactDOM + Babelï¼ˆè®“ç€è¦½å™¨ç›´æ¥è·‘ JSXï¼Œç”¨å°±å¥½ï¼Œå…ˆä¸ç”¨ç†è§£ï¼‰ -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- ä½ çš„æ•´å€‹ App å¯«åœ¨é€™è£¡ -->
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ç°¡å–®çš„ Icon æ›¿ä»£ï¼ˆç”¨ emoji ä»£æ›¿ lucide-reactï¼Œé€™æ¨£å°±ä¸éœ€è¦å®‰è£å¥—ä»¶ï¼‰
    const makeIcon = (emoji) => ({ className }) => (
      <span className={className} style={{ display: 'inline-block' }}>{emoji}</span>
    );

    const Calendar   = makeIcon("ğŸ“…");
    const Clock      = makeIcon("â°");
    const Heart      = makeIcon("â¤ï¸");
    const Edit2      = makeIcon("âœï¸");
    const RotateCcw  = makeIcon("ğŸ”");
    const Info       = makeIcon("â„¹ï¸");
    const Activity   = makeIcon("ğŸ“ˆ");
    const Users      = makeIcon("ğŸ‘¥");
    const Plus       = makeIcon("ï¼‹");
    const Trash2     = makeIcon("ğŸ—‘ï¸");
    const ArrowLeft  = makeIcon("â†");
    const ChevronRight = makeIcon("â€º");
    const Gift       = makeIcon("ğŸ");
    const User       = makeIcon("ğŸ‘¤");
    const Star       = makeIcon("â­");
    const Sparkles   = makeIcon("âœ¨");
    const X          = makeIcon("âœ–");
    const Check      = makeIcon("âœ”");
    const AlertTriangle = makeIcon("âš ï¸");
    const Hourglass  = makeIcon("â³");

    // --- ç¬¬ä¸‰æ–¹è¾²æ›†åº«åŠ è¼‰ (å‹•æ…‹æ³¨å…¥) ---
    const useLunar = () => {
      const [isLoaded, setIsLoaded] = useState(false);

      useEffect(() => {
        if (window.Solar && window.Lunar) {
          setIsLoaded(true);
          return;
        }
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js';
        script.async = true;
        script.onload = () => setIsLoaded(true);
        document.body.appendChild(script);
      }, []);

      return isLoaded;
    };

    // --- å­å…ƒä»¶: ç¢ºèªè¦–çª— ---
    const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message }) => {
      if (!isOpen) return null;
      
      return (
        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in" onClick={onClose}>
          <div 
            className="bg-[#1e293b] border border-white/10 rounded-3xl p-6 max-w-sm w-full shadow-2xl transform transition-all scale-100 animate-fade-in-up"
            onClick={e => e.stopPropagation()} 
          >
            <div className="flex items-center gap-3 mb-3 text-red-400">
              <div className="p-2 bg-red-500/10 rounded-full">
                <AlertTriangle className="w-6 h-6" />
              </div>
              <h3 className="text-xl font-bold text-white">{title}</h3>
            </div>
            <p className="text-gray-400 mb-6 leading-relaxed">{message}</p>
            <div className="flex gap-3">
              <button 
                onClick={onClose}
                className="flex-1 px-4 py-3 rounded-xl bg-white/5 text-gray-300 hover:bg-white/10 transition-colors font-medium"
              >
                å–æ¶ˆ
              </button>
              <button 
                onClick={onConfirm}
                className="flex-1 px-4 py-3 rounded-xl bg-gradient-to-r from-red-500 to-rose-600 text-white hover:from-red-600 hover:to-rose-700 shadow-lg shadow-red-500/20 transition-all transform hover:scale-[1.02] font-bold"
              >
                ç¢ºèªåˆªé™¤
              </button>
            </div>
          </div>
        </div>
      );
    };

    // --- å­å…ƒä»¶: æ•¸å­—å¡ç‰‡ ---
    const NumberCard = ({ value, label, subLabel, highlight = false }) => (
      <div className={
        "relative flex flex-col items-center justify-center p-4 rounded-2xl backdrop-blur-md border border-white/10 transition-all duration-300 hover:transform hover:scale-105 shadow-lg shadow-black/10 " + 
        (highlight ? "bg-gradient-to-br from-indigo-500/20 to-purple-500/20 border-indigo-300/30" : "bg-white/5")
      }>
        <span className={
          "text-4xl md:text-5xl font-mono font-bold tracking-tight tabular-nums " +
          (highlight ? "text-indigo-200" : "text-white")
        }>
          {value}
        </span>
        <span className="text-xs md:text-sm text-gray-300 mt-1 uppercase tracking-widest">{label}</span>
        {subLabel && <span className="text-[10px] text-gray-400">{subLabel}</span>}
      </div>
    );

    // --- å­å…ƒä»¶: é‡Œç¨‹ç¢‘è¡Œ ---
    const MilestoneRow = React.memo(({ label, value, unit }) => (
      <div className="group flex justify-between items-center py-5 border-b border-white/5 first:pt-0 last:border-0 hover:bg-white/5 px-4 -mx-4 rounded-xl transition-all duration-300 cursor-default">
        <span className="text-gray-400 group-hover:text-indigo-200 transition-colors font-medium tracking-wide flex items-center gap-2">
          <Activity className="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity text-indigo-400" />
          {label}
        </span>
        <div className="relative">
          <span className="font-mono text-xl md:text-2xl text-white/20 tabular-nums block">
            {value} <span className="text-xs md:text-sm font-sans">{unit}</span>
          </span>
          <div className="absolute bottom-0 left-0 w-full h-0 overflow-hidden transition-[height] duration-[2000ms] ease-in-out group-hover:h-full">
            <span className="absolute bottom-0 left-0 w-full font-mono text-xl md:text-2xl text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 to-purple-300 tabular-nums text-right">
              {value} <span className="text-xs md:text-sm font-sans text-indigo-200">{unit}</span>
            </span>
          </div>
        </div>
      </div>
    ));

    // --- è¼”åŠ©å‡½æ•¸ ---
    const calculateDetails = (dateStr, timeStr) => {
      const start = new Date(dateStr + "T" + timeStr);
      const now = new Date();
      if (start > now) return null;

      const diffInMs = now.getTime() - start.getTime();
      const totalSeconds = Math.floor(diffInMs / 1000);

      let years = now.getFullYear() - start.getFullYear();
      let months = now.getMonth() - start.getMonth();
      let days = now.getDate() - start.getDate();
      let hours = now.getHours() - start.getHours();
      let minutes = now.getMinutes() - start.getMinutes();
      let seconds = now.getSeconds() - start.getSeconds();

      if (seconds < 0) { seconds += 60; minutes--; }
      if (minutes < 0) { minutes += 60; hours--; }
      if (hours < 0) { hours += 24; days--; }
      if (days < 0) {
        const previousMonth = new Date(now.getFullYear(), now.getMonth(), 0);
        days += previousMonth.getDate();
        months--;
      }
      if (months < 0) { months += 12; years--; }

      return { years, months, days, hours, minutes, seconds, totalSeconds };
    };

    const calculateCountdown = (dateStr, timeStr) => {
      const target = new Date(dateStr + "T" + timeStr);
      const now = new Date();
      const diffInMs = target.getTime() - now.getTime();

      const isSameDay =
        target.getFullYear() === now.getFullYear() &&
        target.getMonth() === now.getMonth() &&
        target.getDate() === now.getDate();

      if (diffInMs > 0) {
        const totalSeconds = Math.floor(diffInMs / 1000);
        const days = Math.floor(totalSeconds / (3600 * 24));
        const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;

        let tempDate = new Date(now);
        let cYears = target.getFullYear() - tempDate.getFullYear();
        let cMonths = target.getMonth() - tempDate.getMonth();
        let cDays = target.getDate() - tempDate.getDate();

        if (cDays < 0) {
          const prevMonth = new Date(target.getFullYear(), target.getMonth(), 0);
          cDays += prevMonth.getDate();
          cMonths--;
        }
        if (cMonths < 0) {
          cMonths += 12;
          cYears--;
        }

        return {
          status: 'future',
          years: cYears, months: cMonths, days: cDays,
          hours, minutes, seconds,
          totalSeconds,
          totalDays: days
        };
      } else {
        if (isSameDay) {
          const endOfDay = new Date(
            now.getFullYear(),
            now.getMonth(),
            now.getDate(),
            23, 59, 59
          );
          const endDiff = endOfDay.getTime() - now.getTime();
          const endTotalSeconds = Math.floor(endDiff / 1000);

          const hours = Math.floor(endTotalSeconds / 3600);
          const minutes = Math.floor((endTotalSeconds % 3600) / 60);
          const seconds = endTotalSeconds % 60;

          return {
            status: 'today',
            years: 0, months: 0, days: 0,
            hours, minutes, seconds,
            totalSeconds: endTotalSeconds
          };
        } else {
          return { status: 'past' };
        }
      }
    };

    const getLunarString = (dateStr) => {
      if (!window.Solar) return "è¼‰å…¥è¾²æ›†ä¸­...";
      try {
        const date = new Date(dateStr);
        const solar = window.Solar.fromYmd(
          date.getFullYear(),
          date.getMonth() + 1,
          date.getDate()
        );
        const lunar = solar.getLunar();
        return lunar.getMonthInChinese() + "æœˆ" + lunar.getDayInChinese();
      } catch (e) {
        return "";
      }
    };

    // --- è©³ç´°è¨ˆæ™‚é é¢ ---
    const DetailTimer = ({ profile, onBack, isLoaded }) => {
      const [currentTime, setCurrentTime] = useState(new Date());
      const [stats, setStats] = useState(null);
      const [quoteIndex, setQuoteIndex] = useState(0);

      const quotes = useMemo(() => [
        "æ™‚é–“ä¸èªï¼Œå»å›ç­”äº†æ‰€æœ‰å•é¡Œã€‚",
        "æ¯ä¸€å€‹ä¸æ›¾èµ·èˆçš„æ—¥å­ï¼Œéƒ½æ˜¯å°ç”Ÿå‘½çš„è¾œè² ã€‚",
        "é€è€…å¦‚æ–¯å¤«ï¼Œä¸èˆæ™å¤œã€‚",
        "æ—¢ç„¶æ™‚é–“ç•™ä¸ä½ï¼Œé‚£å°±è¨˜ä½å®ƒã€‚",
        "ç•¶ä¸‹çš„æ¯ä¸€å€‹ç¬é–“ï¼Œéƒ½æ˜¯æœªä¾†çš„å›æ†¶ã€‚",
        "æ­²æœˆæ¥µç¾ï¼Œåœ¨æ–¼å®ƒå¿…ç„¶çš„æµé€ã€‚",
        "æ™‚é–“æ˜¯é€çµ¦æˆ‘å€‘æœ€å…¬å¹³çš„ç¦®ç‰©ã€‚",
        "å¾€äº‹ä¸å›é ­ï¼Œæœªä¾†ä¸å°‡å°±ã€‚",
        "ç”Ÿå‘½ä¸æ˜¯è¦æ´»å¾—é•·ï¼Œè€Œæ˜¯è¦æ´»å¾—å¥½ã€‚",
        "ä½ æ‰€æµªè²»çš„ä»Šå¤©ï¼Œæ˜¯æ˜¨å¤©æ­»å»çš„äººå¥¢æœ›çš„æ˜å¤©ã€‚"
      ], []);

      useEffect(() => {
        const timer = setInterval(() => setCurrentTime(new Date()), 1000);
        if (profile.type === 'countdown') {
          setStats(calculateCountdown(profile.date, profile.time));
        } else {
          setStats(calculateDetails(profile.date, profile.time));
        }
        return () => clearInterval(timer);
      }, [profile]);

      useEffect(() => {
        const quoteTimer = setInterval(() => {
          setQuoteIndex((prev) => (prev + 1) % quotes.length);
        }, 8000);
        return () => clearInterval(quoteTimer);
      }, [quotes.length]);

      useEffect(() => {
        if (profile.type === 'countdown') {
          setStats(calculateCountdown(profile.date, profile.time));
        } else {
          setStats(calculateDetails(profile.date, profile.time));
        }
      }, [currentTime, profile]);

      if (!stats) {
        return (
          <div className="flex flex-col items-center justify-center min-h-[50vh] space-y-4">
            <div className="text-xl text-red-300 font-bold">è¨ˆç®—ä¸­...</div>
            <button onClick={onBack} className="text-gray-400 hover:text-white underline">
              è¿”å›åˆ—è¡¨
            </button>
          </div>
        );
      }

      if (profile.type === 'countdown' && stats.status === 'past') {
        return (
          <div className="flex flex-col items-center justify-center min-h-[50vh] space-y-4 animate-fade-in">
            <div className="p-4 bg-gray-700/50 rounded-full mb-4">
              <Check className="w-12 h-12 text-gray-400" />
            </div>
            <h2 className="text-3xl font-bold text-white mb-2">{profile.name}</h2>
            <div className="text-xl text-gray-400 font-bold">é€™å€‹æ—¥å­å·²ç¶“éå»äº†</div>
            <div className="text-sm text-gray-500 mt-2">{profile.date}</div>
            <button
              onClick={onBack}
              className="mt-8 px-6 py-2 bg-white/10 rounded-full text-white hover:bg-white/20 transition-all"
            >
              è¿”å›åˆ—è¡¨
            </button>
          </div>
        );
      }

      const formatNum = (num) => num.toString().padStart(2, '0');
      const handleQuoteClick = () => {
        setQuoteIndex((prev) => (prev + 1) % quotes.length);
      };

      const themeColor =
        profile.type === 'countdown'
          ? 'from-sky-500/20 to-blue-500/20 border-sky-300/30'
          : profile.type === 'anniversary'
          ? 'from-pink-500/20 to-rose-500/20 border-pink-300/30'
          : 'from-indigo-500/20 to-purple-500/20 border-indigo-300/30';

      const highlightText =
        profile.type === 'countdown'
          ? 'text-sky-200'
          : profile.type === 'anniversary'
          ? 'text-pink-200'
          : 'text-indigo-200';

      const CustomNumberCard = ({ value, label, subLabel }) => (
        <div className={
          "relative flex flex-col items-center justify-center p-4 rounded-2xl backdrop-blur-md border border-white/10 transition-all duration-300 hover:transform hover:scale-105 bg-gradient-to-br " +
          themeColor +
          " shadow-lg shadow-black/10"
        }>
          <span className={
            "text-4xl md:text-5xl font-mono font-bold tracking-tight tabular-nums " +
            highlightText
          }>
            {value}
          </span>
          <span className="text-xs md:text-sm text-gray-300 mt-1 uppercase tracking-widest">
            {label}
          </span>
          {subLabel && <span className="text-[10px] text-gray-400">{subLabel}</span>}
        </div>
      );

      return (
        <div className="animate-fade-in space-y-8 pb-12">
          <div className="flex items-center justify-between mb-8">
            <button
              onClick={onBack}
              className="flex items-center space-x-2 text-gray-400 hover:text-white transition-colors bg-white/5 hover:bgç™½/10 px-4 py-2 rounded-lg"
            >
              <ArrowLeft className="w-4 h-4" />
              <span>è¿”å›åˆ—è¡¨</span>
            </button>

            <div className="text-right">
              <h2 className="text-xl font-bold text-white">{profile.name}</h2>
              <div className="flex items-center justify-end gap-2 text-xs text-gray-400">
                {profile.type === 'countdown' && stats.status === 'today' ? (
                  <span className="text-amber-400 font-bold animate-pulse mr-2">
                    ç¯€æ—¥çµæŸå€’è¨ˆæ™‚
                  </span>
                ) : profile.type === 'countdown' ? (
                  <span className="text-sky-300 mr-2">å³å°‡åˆ°ä¾†</span>
                ) : (
                  <span className="mr-2">{profile.relation}</span>
                )}

                <span className="w-1 h-1 bg-gray-600 rounded-full"></span>
                <span>{profile.date}</span>
                {isLoaded && profile.type === 'life' && (
                  <span className="text-indigo-300">
                    {" "}
                    (è¾²æ›† {getLunarString(profile.date)})
                  </span>
                )}
              </div>
            </div>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 md:gap-4">
            {profile.type === 'countdown' && stats.status === 'today' ? (
              <>
                <div className="hidden md:block col-span-3"></div>
                <CustomNumberCard value={formatNum(stats.hours)} label="å°æ™‚" />
                <CustomNumberCard value={formatNum(stats.minutes)} label="åˆ†é˜" />
                <CustomNumberCard
                  value={formatNum(stats.seconds)}
                  label="ç§’"
                  subLabel="å³æ™‚è·³å‹•"
                />
              </>
            ) : (
              <>
                <NumberCard value={stats.years} label="å¹´" highlight={profile.type !== 'countdown'} />
                <NumberCard value={stats.months} label="å€‹æœˆ" />
                <NumberCard value={stats.days} label="å¤©" />
                <NumberCard value={formatNum(stats.hours)} label="å°æ™‚" />
                <NumberCard value={formatNum(stats.minutes)} label="åˆ†é˜" />
                <NumberCard
                  value={formatNum(stats.seconds)}
                  label="ç§’"
                  subLabel="å³æ™‚è·³å‹•"
                />
              </>
            )}
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
            <div className={
              "bg-gradient-to-br rounded-3xl p-8 border border-white/5 relative overflow-hidden group hover:border-white/20 transition-all duration-500 shadow-xl shadow-black/20 " +
              (profile.type === 'countdown'
                ? stats.status === 'today'
                  ? "from-amber-600/40 to-orange-700/40"
                  : "from-sky-800/40 to-blue-900/40"
                : profile.type === 'anniversary'
                ? "from-pink-900/40 to-rose-900/40"
                : "from-slate-800 to-slate-900")
            }>
              <div className="absolute bottom-2 right-2 w-32 h-32 opacity-20 group-hover:opacity-40 transition-opacity duration-500 group-hover:animate-heartbeat pointer-events-none">
                {profile.type === 'countdown' ? (
                  <Hourglass className="w-full h-full text-white" />
                ) : (
                  <Heart className="w-full h-full text-white" />
                )}
              </div>

              <h3 className="text-gray-400 text-sm font-medium mb-2 uppercase tracking-wider relative z-10">
                {profile.type === 'countdown'
                  ? stats.status === 'today'
                    ? 'è·é›¢ä»Šå¤©çµæŸé‚„æœ‰'
                    : 'è·é›¢ç›®æ¨™é‚„æœ‰'
                  : profile.type === 'life'
                  ? 'åœ¨é€™å€‹æ˜Ÿçƒä¸Šçš„ç¸½ç§’æ•¸'
                  : 'ç´¯ç©ç¸½ç§’æ•¸'}
              </h3>

              <div className="text-2xl sm:text-3xl md:text-5xl lg:text-6xl font-mono font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-teal-300 tracking-tighter relative z-10 transition-all duration-1000 tabular-nums whitespace-nowrap overflow-visible">
                {stats.totalSeconds.toLocaleString()}{" "}
                <span className="text-base text-gray-400 font-sans">ç§’</span>
              </div>

              <p className="text-xs text-gray-500 mt-4 relative z-10 transition-colors max-w-[80%]">
                {profile.type === 'countdown'
                  ? stats.status === 'today'
                    ? 'æŠŠæ¡æœ€å¾Œçš„æ™‚å…‰'
                    : 'æœŸå¾…è‘—é‚£ä¸€åˆ»çš„åˆ°ä¾†'
                  : profile.type === 'life'
                  ? 'æ¯ä¸€æ¬¡å¿ƒè·³éƒ½æ˜¯æ™‚é–“çš„é¥‹è´ˆ'
                  : 'æ¯ä¸€ç§’éƒ½æ˜¯çè²´çš„å›æ†¶'}
              </p>
            </div>

            <div className="flex flex-col justify-center px-4 py-2">
              <h3 className="text-gray-400 text-sm font-medium mb-6 uppercase tracking-wider px-4">
                {profile.type === 'countdown' ? 'å€’æ•¸çµ±è¨ˆ' : 'ç´¯ç©é‡Œç¨‹ç¢‘'}
              </h3>
              <div className="space-y-2">
                {profile.type === 'countdown' ? (
                  <>
                    <MilestoneRow
                      label="ç¸½å¤©æ•¸"
                      value={stats.totalDays || Math.floor(stats.totalSeconds / (3600 * 24))}
                      unit="å¤©"
                    />
                    <MilestoneRow
                      label="ç¸½å°æ™‚"
                      value={Math.floor(stats.totalSeconds / 3600).toLocaleString()}
                      unit="æ™‚"
                    />
                  </>
                ) : (
                  <>
                    <MilestoneRow
                      label="ç¸½å¤©æ•¸"
                      value={Math.floor(stats.totalSeconds / (24 * 3600)).toLocaleString()}
                      unit="å¤©"
                    />
                    <MilestoneRow
                      label="ç¸½é€±æ•¸"
                      value={Math.floor(stats.totalSeconds / (7 * 24 * 3600)).toLocaleString()}
                      unit="é€±"
                    />
                    <MilestoneRow
                      label="ç¸½å°æ™‚"
                      value={Math.floor(stats.totalSeconds / 3600).toLocaleString()}
                      unit="æ™‚"
                    />
                  </>
                )}
              </div>
            </div>
          </div>

          <div
            className="mt-12 pt-8 border-t borderç™½/5 text-center relative overflow-hidden cursor-pointer select-none group"
            onClick={handleQuoteClick}
            title="é»æ“Šåˆ‡æ›åè¨€"
          >
            <div className="flex justify-center gap-4 mb-4 text-indigo-300/40 group-hover:text-indigo-300/60 transition-colors">
              <Sparkles className="w-4 h-4" />
              <Star className="w-4 h-4" />
              <Sparkles className="w-4 h-4" />
            </div>

            <p className="text-sm font-serif text-gray-400 italic tracking-wide transition-opacity duration-500 min-h-[1.5em] group-hover:text-indigo-200">
              "{quotes[quoteIndex]}"
            </p>
            <div className="mt-2 text-[10px] text-gray-600 uppercase tracking-[0.2em]">
              Time Journey â€¢ {profile.name}
            </div>
          </div>
        </div>
      );
    };

    // --- ä¸»ç¨‹å¼ ---
    const LifeJourney = () => {
      const isLoaded = useLunar();
      const [view, setView] = useState('dashboard');
      const [activeTab, setActiveTab] = useState('life');
      const [isDeleteMode, setIsDeleteMode] = useState(false);
      const [deleteTargetId, setDeleteTargetId] = useState(null);

      const [profiles, setProfiles] = useState(() => {
        const saved = localStorage.getItem('lifeJourneyProfiles');
        return saved ? JSON.parse(saved) : [];
      });

      const [selectedProfileId, setSelectedProfileId] = useState(null);

      const [formData, setFormData] = useState({
        name: '',
        relation: '',
        date: '',
        time: '00:00',
        type: 'life'
      });

      useEffect(() => {
        localStorage.setItem('lifeJourneyProfiles', JSON.stringify(profiles));
      }, [profiles]);

      const handleAddProfile = () => {
        if (!formData.name || !formData.date) return;
        const newProfile = {
          id: Date.now().toString(),
          ...formData
        };
        setProfiles([...profiles, newProfile]);
        setFormData({ name: '', relation: '', date: '', time: '00:00', type: activeTab });
        setView('dashboard');
      };

      const requestDelete = (e, id) => {
        e.stopPropagation();
        setDeleteTargetId(id);
      };

      const confirmDelete = () => {
        if (deleteTargetId) {
          setProfiles(prev => {
            const newProfiles = prev.filter(p => p.id !== deleteTargetId);
            if (newProfiles.length === 0) setIsDeleteMode(false);
            return newProfiles;
          });
          if (selectedProfileId === deleteTargetId) {
            setView('dashboard');
            setSelectedProfileId(null);
          }
          setDeleteTargetId(null);
        }
      };

      const openDetail = (profile) => {
        if (isDeleteMode) return;
        setSelectedProfileId(profile.id);
        setView('detail');
      };

      const displayProfiles = useMemo(
        () => profiles.filter(p => p.type === activeTab),
        [profiles, activeTab]
      );

      const selectedProfile = useMemo(
        () => profiles.find(p => p.id === selectedProfileId),
        [profiles, selectedProfileId]
      );

      const renderForm = () => (
        <div className="max-w-md mx-auto bg-white/5 backdrop-blur-xl rounded-3xl p-8 border border-white/10 shadow-2xl animate-fade-in-up">
          <div className="flex items-center space-x-2 mb-6 text-indigo-300">
            {formData.type === 'life' ? (
              <User className="w-5 h-5" />
            ) : formData.type === 'anniversary' ? (
              <Gift className="w-5 h-5" />
            ) : (
              <Hourglass className="w-5 h-5" />
            )}
            <span className="font-semibold tracking-wide">
              æ–°å¢{formData.type === 'life' ? 'æ™‚å…‰è¶³è·¡' : formData.type === 'anniversary' ? 'ç´€å¿µæ—¥' : 'å€’æ•¸æ—¥'}
            </span>
          </div>

          <div className="space-y-5">
            <div>
              <label className="block text-sm text-gray-400 mb-2">é¡¯ç¤ºåç¨±</label>
              <input
                type="text"
                placeholder={formData.type === 'countdown' ? "ä¾‹å¦‚ï¼šæœŸæœ«è€ƒã€æ–°å¹´" : "ä¾‹å¦‚ï¼šç‹å°æ˜ã€æˆ‘å€‘çš„å©šç¦®"}
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 textç™½ focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all placeholder-gray-600"
              />
            </div>

            <div>
              <label className="block text-sm text-gray-400 mb-2">
                {formData.type === 'countdown' ? 'å‚™è¨» / æè¿°' : 'é—œä¿‚ / æè¿° (è‡ªè¨‚)'}
              </label>
              <input
                type="text"
                placeholder={formData.type === 'countdown' ? "ä¾‹å¦‚ï¼šé‡è¦è€ƒè©¦ã€å…¨å®¶åœ˜åœ“" : "ä¾‹å¦‚ï¼šæ‘¯å‹ã€çˆ¶è¦ªã€åœ¨ä¸€èµ·"}
                value={formData.relation}
                onChange={e => setFormData({ ...formData, relation: e.target.value })}
                className="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 textç™½ focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all placeholder-gray-600"
              />
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm text-gray-400 mb-2">æ—¥æœŸ</label>
                <input
                  type="date"
                  value={formData.date}
                  onChange={e => setFormData({ ...formData, date: e.target.value })}
                  className="w-full bg-black/20 border borderç™½/10 rounded-xl px-4 py-3 textç™½ focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all"
                />
              </div>
              <div>
                <label className="block text-sm text-gray-400 mb-2">æ™‚é–“</label>
                <input
                  type="time"
                  value={formData.time}
                  onChange={e => setFormData({ ...formData, time: e.target.value })}
                  className="w-full bg-black/20 border borderç™½/10 rounded-xl px-4 py-3 textç™½ focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all"
                />
              </div>
            </div>

            <div className="flex gap-3 pt-4">
              <button
                onClick={() => setView('dashboard')}
                className="flex-1 bgç™½/5 hover:bgç™½/10 textç™½ font-medium py-3 rounded-xl transition-all"
              >
                å–æ¶ˆ
              </button>
              <button
                onClick={handleAddProfile}
                disabled={!formData.name || !formData.date}
                className="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 textç™½ font-bold py-3 rounded-xl shadow-lg shadow-indigo-500/20 transition-all disabled:opacity-50"
              >
                å„²å­˜
              </button>
            </div>
          </div>
        </div>
      );

      const renderDashboard = () => (
        <div className="animate-fade-in max-w-4xl mx-auto pb-24">
          <ConfirmModal
            isOpen={!!deleteTargetId}
            onClose={() => setDeleteTargetId(null)}
            onConfirm={confirmDelete}
            title="åˆªé™¤ç¢ºèª"
            message="æ‚¨ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿåˆªé™¤å¾Œå°‡ç„¡æ³•å¾©åŸã€‚"
          />

          <div className="flex p-1 bg-white/5 rounded-2xl mb-8 w-fit mx-auto border borderç™½/10 overflow-x-auto">
            <button
              onClick={() => setActiveTab('life')}
              className={
                "flex items-center space-x-2 px-6 py-2 rounded-xl transition-all text-sm font-medium whitespace-nowrap " +
                (activeTab === 'life' ? 'bg-indigo-500 textç™½ shadow-lg' : 'text-gray-400 hover:textç™½')
              }
            >
              <User className="w-4 h-4" />
              <span>æ™‚å…‰è¶³è·¡</span>
            </button>
            <button
              onClick={() => setActiveTab('anniversary')}
              className={
                "flex items-center space-x-2 px-6 py-2 rounded-xl transition-all text-sm font-medium whitespace-nowrap " +
                (activeTab === 'anniversary' ? 'bg-pink-500 textç™½ shadow-lg' : 'text-gray-400 hover:textç™½')
              }
            >
              <Gift className="w-4 h-4" />
              <span>ç´€å¿µæ—¥</span>
            </button>
            <button
              onClick={() => setActiveTab('countdown')}
              className={
                "flex items-center space-x-2 px-6 py-2 rounded-xl transition-all text-sm font-medium whitespace-nowrap " +
                (activeTab === 'countdown' ? 'bg-sky-500 textç™½ shadow-lg' : 'text-gray-400 hover:textç™½')
              }
            >
              <Hourglass className="w-4 h-4" />
              <span>å€’æ•¸æ—¥</span>
            </button>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {displayProfiles.map(profile => {
              let details = null;
              let isFuture = false;
              let isToday = false;

              if (profile.type === 'countdown') {
                details = calculateCountdown(profile.date, profile.time);
                if (details.status === 'future') isFuture = true;
                if (details.status === 'today') isToday = true;
              } else {
                details = calculateDetails(profile.date, profile.time);
              }

              if (!details && profile.type !== 'countdown') return null;
              const isCountdownPast = profile.type === 'countdown' && details.status === 'past';

              return (
                <div
                  key={profile.id}
                  onClick={() => openDetail(profile)}
                  className={
                    "group relative bg-white/5 hover:bg-white/10 border border-white/5 rounded-2xl p-6 transition-all overflow-hidden " +
                    (isDeleteMode ? 'border-red-500/30 bg-red-500/5 cursor-default' : 'hover:border-indigo-500/30 cursor-pointer')
                  }
                >
                  {isDeleteMode && (
                    <div className="absolute bottom-3 right-3 z-30 animate-fade-in-up">
                      <button
                        onClick={e => requestDelete(e, profile.id)}
                        className="flex items-center justify-center w-8 h-8 bg-red-500 textç™½ rounded-full shadow-lg hover:bg-red-600 hover:scale-110 transition-all"
                      >
                        <X className="w-5 h-5" />
                      </button>
                    </div>
                  )}

                  <div className="flex justify-between items-start mb-4">
                    <div>
                      <div className="flex items-center gap-2 mb-1">
                        <h3 className="text-xl font-bold textç™½ group-hover:text-indigo-200 transition-colors">
                          {profile.name}
                        </h3>
                        {profile.type === 'countdown' ? (
                          isToday ? (
                            <span className="px-2 py-0.5 rounded-full bg-amber-500/20 text-[10px] text-amber-300 border border-amber-500/30 font-bold animate-pulse">
                              ç¯€æ—¥çµæŸå€’è¨ˆæ™‚
                            </span>
                          ) : isFuture ? (
                            <span className="px-2 py-0.5 rounded-full bg-sky-500/20 text-[10px] text-sky-300 border border-sky-500/30">
                              å³å°‡åˆ°ä¾†
                            </span>
                          ) : (
                            <span className="px-2 py-0.5 rounded-full bg-gray-500/20 text-[10px] text-gray-400 border border-gray-500/30">
                              å·²çµæŸ
                            </span>
                          )
                        ) : (
                          profile.relation && (
                            <span className="px-2 py-0.5 rounded-full bgç™½/10 text-[10px] text-gray-300 border borderç™½/10">
                              {profile.relation}
                            </span>
                          )
                        )}
                      </div>
                      <div className="text-xs text-gray-500 flex items-center gap-2">
                        <span>{profile.date}</span>
                        {isLoaded && profile.type === 'life' && (
                          <span className="text-indigo-300/70 bg-indigo-500/10 px-1.5 rounded text-[10px]">
                            è¾² {getLunarString(profile.date)}
                          </span>
                        )}
                      </div>
                    </div>
                    {!isDeleteMode && (
                      <ChevronRight className="w-5 h-5 text-gray-600 group-hover:translate-x-1 transition-transform" />
                    )}
                  </div>

                  <div className="flex items-baseline space-x-2">
                    {isCountdownPast ? (
                      <span className="text-xl font-mono text-gray-500">æ—¥å­å·²é</span>
                    ) : isToday ? (
                      <>
                        <span className="text-3xl font-mono font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-orange-300">
                          {details.hours.toString().padStart(2, '0')}:
                          {details.minutes.toString().padStart(2, '0')}:
                          {details.seconds.toString().padStart(2, '0')}
                        </span>
                        <span className="text-xs text-gray-400 uppercase tracking-wider">å‰©é¤˜</span>
                      </>
                    ) : (
                      <>
                        <span className={
                          "text-3xl font-mono font-bold text-transparent bg-clip-text bg-gradient-to-r " +
                          (profile.type === 'countdown' ? 'from-sky-300 to-blue-300' : 'from-indigo-300 to-purple-300')
                        }>
                          {details.years > 0 ? details.years : details.days}
                        </span>
                        <span className="text-xs text-gray-400 uppercase tracking-wider">
                          {details.years > 0 ? 'å¹´' : 'å¤©'}
                        </span>
                        {details.years > 0 && (
                          <>
                            <span className={
                              "text-3xl font-mono font-bold text-transparent bg-clip-text bg-gradient-to-r " +
                              (profile.type === 'countdown' ? 'from-sky-300 to-blue-300' : 'from-indigo-300 to-purple-300') +
                              " ml-2"
                            }>
                              {details.days}
                            </span>
                            <span className="text-xs text-gray-400 uppercase tracking-wider">å¤©</span>
                          </>
                        )}
                      </>
                    )}
                  </div>
                </div>
              );
            })}

            {!isDeleteMode && (
              <button
                onClick={() => {
                  setFormData({ name: '', relation: '', date: '', time: '00:00', type: activeTab });
                  setView('form');
                }}
                className="flex flex-col items-center justify-center h-[180px] rounded-2xl border-2 border-dashed border-white/10 hover:border-indigo-500/50 hover:bg-indigo-500/5 transition-all group"
              >
                <div className="p-4 rounded-full bgç™½/5 group-hover:scale-110 transition-transform mb-3">
                  <Plus className="w-6 h-6 text-gray-400 group-hover:text-indigo-400" />
                </div>
                <span className="text-sm text-gray-400 font-medium group-hover:text-indigo-300">
                  æ–°å¢{activeTab === 'life' ? 'æ™‚å…‰è¶³è·¡' : activeTab === 'anniversary' ? 'ç´€å¿µæ—¥' : 'å€’æ•¸æ—¥'}
                </span>
              </button>
            )}
          </div>

          {displayProfiles.length > 0 && (
            <div className="fixed bottom-6 left-6 z-50">
              <button
                onClick={() => setIsDeleteMode(!isDeleteMode)}
                className={
                  "flex items-center justify-center w-12 h-12 rounded-full shadow-2xl backdrop-blur-md border borderç™½/10 transition-all duration-300 " +
                  (isDeleteMode
                    ? 'bgç™½ text-red-500 rotate-180'
                    : 'bg-black/40 text-gray-400 hover:textç™½ hover:bg-black/60')
                }
                title={isDeleteMode ? "å®Œæˆç·¨è¼¯" : "ç·¨è¼¯/åˆªé™¤"}
              >
                {isDeleteMode ? <Check className="w-6 h-6" /> : <Edit2 className="w-5 h-5" />}
              </button>
            </div>
          )}
        </div>
      );

      return (
        <div className="min-h-screen textç™½ overflow-hidden selection:bg-indigo-500 selection:textç™½ pb-20">
          <div className="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
            <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-purple-900/10 rounded-full blur-[120px]"></div>
            <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-indigo-900/10 rounded-full blur-[120px]"></div>
          </div>

          <div className="container mx-auto px-4 py-8 md:py-16 max-w-5xl">
            {view === 'dashboard' && (
              <header className="flex flex-col items-center mb-12 text-center animate-fade-in-down">
                <div className="p-3 bgç™½/5 rounded-full mb-4 ring-1 ringç™½/20">
                  <Clock className="w-8 h-8 text-indigo-400" />
                </div>
                <h1 className="text-3xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-200 to-purple-200 mb-2">
                  æ™‚å…‰æ—…ç¨‹
                </h1>
                <p className="text-gray-400 max-w-xl text-sm md:text-base">
                  ç´€éŒ„æ¯ä¸€å€‹é‡è¦çš„äººï¼Œèˆ‡æ¯ä¸€å€‹å€¼å¾—ç´€å¿µçš„ç¬é–“ã€‚
                </p>
              </header>
            )}

            {view === 'dashboard' && renderDashboard()}
            {view === 'form' && renderForm()}
            {view === 'detail' && selectedProfile && (
              <DetailTimer profile={selectedProfile} onBack={() => setView('dashboard')} isLoaded={isLoaded} />
            )}
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<LifeJourney />);
  </script>
</body>
</html>
